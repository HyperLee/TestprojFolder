# Feature Specification: 世界時鐘 (World Clock)

**Feature Branch**: `003-world-clock`  
**Created**: 2025-11-01  
**Status**: Draft  
**Input**: User description: "世界時鐘開發 - 多時區時間顯示與互動切換功能"

## Clarifications

### Session 2025-11-01

- Q: 當瀏覽器時區 API 失敗時，應該如何處理？ → A: 顯示「無法偵測時區」錯誤訊息，並提供手動重新整理按鈕
- Q: 在頁面載入期間（2 秒內）是否需要顯示載入指示器？ → A: 顯示簡單的載入動畫（如旋轉圖示）和「載入中...」文字
- Q: 是否需要支援無障礙功能（鍵盤導航、螢幕閱讀器）？ → A: 支援基本無障礙：ARIA live regions 通知時間更新，鍵盤 Tab/Enter 導航
- Q: 最低支援的瀏覽器版本為何？ → A: 支援主流現代瀏覽器最新 2 個主要版本（Chrome/Edge 90+, Firefox 88+, Safari 14+）
- Q: 如果時間更新在長時間執行後停止，應該如何處理？ → A: 實作心跳檢測：每分鐘檢查上次更新時間，若超過 5 秒未更新則自動重啟計時器

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看多個城市時間 (Priority: P1)

使用者可以同時查看多個世界主要城市的當前時間，快速了解不同時區的時間狀態。

**Why this priority**: 這是世界時鐘的核心價值，讓使用者能夠一目了然地看到全球不同城市的時間，是最基本且最重要的功能。

**Independent Test**: 可以透過載入頁面並驗證是否顯示所有預設城市（台北、東京、倫敦、紐約、洛杉磯、巴黎、柏林、莫斯科、新加坡、悉尼）的正確時間來獨立測試此功能。

**Acceptance Scenarios**:

1. **Given** 使用者開啟世界時鐘頁面，**When** 頁面開始載入，**Then** 顯示載入動畫（旋轉圖示）和「載入中...」文字
2. **Given** 使用者開啟世界時鐘頁面，**When** 頁面載入完成，**Then** 正中央顯示本地時間（預設為台北時間 GMT+8），下方以網格方式顯示其他 9 個城市的時間
3. **Given** 系統正在顯示各城市時間，**When** 時間每秒更新，**Then** 所有顯示的時間同步更新且格式為 HH:mm:ss（24 小時制）
4. **Given** 使用者查看時鐘頁面，**When** 觀察城市時間卡片，**Then** 每個城市顯示城市名稱、時區標示（如 GMT+8）和當前時間
5. **Given** 使用者查看主要時間區域，**When** 檢視右下角，**Then** 顯示當前日期（格式：YYYY-MM-DD），且日期跟隨主要時間的時區

---

### User Story 2 - 切換主要顯示時間 (Priority: P2)

使用者可以點選任一城市時間，將該城市時間設定為主要顯示，方便重點關注特定時區。

**Why this priority**: 此功能提供了互動性和個人化體驗，讓使用者可以根據需求調整主要關注的時區，提升使用便利性。

**Independent Test**: 可以透過點選任一城市時間卡片，驗證該時間是否移至正中央成為主要顯示，且原主要時間移至城市列表中來測試此功能。

**Acceptance Scenarios**:

1. **Given** 使用者正在查看世界時鐘（主要顯示為台北時間），**When** 點選東京的時間卡片，**Then** 東京時間移至正中央成為主要顯示，台北時間移至下方城市列表中
2. **Given** 使用者將滑鼠移至任一城市時間卡片上方，**When** 停留片刻，**Then** 該卡片顯示視覺回饋效果（背景色變為 #e9ecef）
3. **Given** 使用者點選城市時間卡片，**When** 點擊動作執行中，**Then** 卡片顯示藍色邊框（#007bff）的點選動畫效果
4. **Given** 切換主要時間後，**When** 觀察右下角日期，**Then** 日期根據新的主要時間的時區進行更新

---

### User Story 3 - 自動處理時區變化 (Priority: P3)

系統自動處理夏令時間轉換和日期變更，確保時間顯示的準確性。

**Why this priority**: 這是確保資料準確性的重要功能，但相對於核心顯示和互動功能，屬於背景自動處理的進階功能。

**Independent Test**: 可以透過模擬夏令時間轉換期間或跨日期時段，驗證系統是否自動調整時區縮寫（如 GMT+0/GMT+1）和日期來測試此功能。

**Acceptance Scenarios**:

1. **Given** 系統顯示倫敦時間，**When** 遇到夏令時間轉換（如從 GMT+0 轉為 GMT+1），**Then** 系統自動更新時區標示為 GMT+1，時間顯示維持準確
2. **Given** 系統顯示紐約時間為 23:59:59，**When** 時間跨越到隔天 00:00:00，**Then** 日期自動更新為新的日期
3. **Given** 系統顯示多個城市時間，**When** 不同城市處於不同的夏令時間狀態，**Then** 每個城市的時區標示正確反映其當前的夏令時間狀態（如紐約顯示 GMT-5 或 GMT-4）

---

### Edge Cases

- **時區跨日問題**：當主要時間顯示的城市與本地時間不在同一天時，日期顯示是否正確跟隨主要時間的時區？
- **夏令時間轉換邊界**：在夏令時間轉換的瞬間（如凌晨 2:00），時間顯示是否會出現跳躍或錯誤？
- **瀏覽器時區設定不正確**：如果瀏覽器的 Intl.DateTimeFormat API 無法正常偵測時區或傳回錯誤，系統將顯示「無法偵測時區，請重新整理頁面」的錯誤訊息，並提供重新整理按鈕讓使用者重試。
- **長時間執行**：系統實作心跳檢測機制，每分鐘檢查上次更新時間，若超過 5 秒未更新則自動重啟計時器並記錄錯誤到 console，確保頁面持續運行 24 小時後時間顯示仍保持準確。
- **快速切換主要時間**：如果使用者快速連續點選多個城市時間卡片，動畫和狀態切換是否會正確處理？
- **不支援的瀏覽器**：在低於最低版本要求的瀏覽器（Chrome/Edge < 90, Firefox < 88, Safari < 14）上，Intl.DateTimeFormat 可能不完整支援，系統應在頁面載入時偵測並顯示瀏覽器升級建議。

## Requirements *(mandatory)*

### Functional Requirements

#### 時間顯示與更新

- **FR-001**: 系統 MUST 在頁面載入期間顯示載入動畫（旋轉圖示）和「載入中...」文字
- **FR-002**: 系統 MUST 在頁面正中央顯示一個主要時間區域，預設顯示台北時間（GMT+8）
- **FR-003**: 系統 MUST 在主要時間區域下方以網格方式排列顯示 9 個其他城市的時間：東京、倫敦、紐約、洛杉磯、巴黎、柏林、莫斯科、新加坡、悉尼
- **FR-004**: 系統 MUST 使用 24 小時制格式（HH:mm:ss）顯示所有時間
- **FR-005**: 系統 MUST 在每個時間旁邊顯示城市名稱和時區標示（格式：城市名稱 + 時區縮寫，如「台北 GMT+8」）
- **FR-006**: 系統 MUST 每秒自動更新所有顯示的時間
- **FR-007**: 系統 MUST 在主要時間區域的右下角顯示當前日期（格式：YYYY-MM-DD，ISO 8601 標準，不隨瀏覽器語言本地化）
- **FR-008**: 日期 MUST 根據主要時間顯示區域所選定的時區來計算和顯示
- **FR-009**: 系統 MUST 實作心跳檢測機制：每分鐘檢查 `ClockState.lastUpdateTime` 時間戳，若發現與當前時間差距超過 5 秒，則自動清除舊計時器並重新啟動，同時記錄錯誤到瀏覽器 console。重啟後時間應立即跳躍到當前正確時間（使用者可感知到一次性的時間更新）

#### 互動功能

- **FR-010**: 使用者 MUST 能夠點選任一城市時間卡片，將該城市時間設定為主要顯示
- **FR-011**: 當使用者點選城市時間後，系統 MUST 將被選中的時間移至正中央的主要顯示區域
- **FR-012**: 當城市時間被移至主要顯示區域後，系統 MUST 將原本的主要時間移至下方城市列表中
- **FR-013**: 系統 MUST 在使用者將滑鼠移至城市時間卡片上方時提供視覺回饋（背景色變為 #e9ecef，使用 CSS 變數 `--hover-bg` 定義以利維護）
- **FR-014**: 系統 MUST 在使用者點選城市時間卡片時提供點選動畫效果（顯示藍色邊框 #007bff，使用 CSS 變數 `--active-border` 定義以利維護）

#### 無障礙功能

- **FR-015**: 系統 MUST 為主要時間區域使用 ARIA live region（aria-live="polite"），當時間更新時通知螢幕閱讀器
- **FR-016**: 系統 MUST 支援鍵盤 Tab 鍵在城市時間卡片之間導航
- **FR-017**: 系統 MUST 支援使用 Enter 鍵選取已聚焦的城市時間卡片，將其設定為主要顯示
- **FR-018**: 所有可互動的城市時間卡片 MUST 具有適當的 ARIA 標籤（aria-label），描述城市名稱和當前時間

#### 時區處理

- **FR-019**: 系統 MUST 自動處理並正確顯示支援夏令時間的城市的時區變化（倫敦 GMT+0/GMT+1、紐約 GMT-5/GMT-4、洛杉磯 GMT-8/GMT-7、巴黎 GMT+1/GMT+2、柏林 GMT+1/GMT+2、悉尼 GMT+10/GMT+11）
- **FR-020**: 系統 MUST 在日期變更時自動更新顯示的日期
- **FR-021**: 系統 MUST 正確計算並顯示每個城市當前的時區偏移量，包括夏令時間的影響
- **FR-022**: 當瀏覽器的 Intl.DateTimeFormat API 無法偵測時區或發生錯誤時，系統 MUST 顯示「無法偵測時區，請重新整理頁面」的錯誤訊息，並提供重新整理按鈕。使用者點選重新整理按鈕後，系統應重新初始化時鐘（清除錯誤狀態、重新建立 Formatter、重新啟動計時器）
- **FR-023**: 系統 MUST 支援以下瀏覽器版本：Chrome/Edge 90+, Firefox 88+, Safari 14+（最新 2 個主要版本）
- **FR-024**: 當偵測到不支援的瀏覽器版本時，系統 MUST 顯示瀏覽器升級建議訊息：「您的瀏覽器版本過舊，可能無法正確顯示時間。請升級至 Chrome 90+、Firefox 88+ 或 Safari 14+」

#### 視覺設計

- **FR-025**: 系統 MUST 使用以下色彩配置（所有色彩值應使用 CSS 變數定義以利維護）：
  - 主背景：#f8f9fa（淺灰）- CSS 變數 `--main-bg`
  - 主要時間區域：#ffffff（白色）+ 陰影效果 - CSS 變數 `--card-bg`
  - 城市時間卡片：#ffffff（白色）+ 邊框 - CSS 變數 `--card-bg`
  - 城市名稱文字：#495057（深灰）- CSS 變數 `--text-secondary`
  - 時間數字文字：#212529（黑色）- CSS 變數 `--text-primary`
  - 日期文字：#6c757d（中灰）- CSS 變數 `--text-muted`
  - Hover 效果背景：#e9ecef（淺灰）- CSS 變數 `--hover-bg`
  - Active 效果邊框：#007bff（藍色）- CSS 變數 `--active-border`
  - 鍵盤焦點指示器：#007bff（藍色）+ 2px 外框 - CSS 變數 `--focus-ring`

- **FR-026**: 系統 MUST 使用以下字體規格：
  - 城市名稱：16px, font-weight: 500
  - 主要時間：48px, font-weight: 700, monospace
  - 城市時間：24px, font-weight: 600, monospace
  - 日期顯示：14px, font-weight: 400

### Key Entities

- **時鐘顯示 (Clock Display)**: 代表一個時間顯示單元，包含城市名稱、時區資訊、當前時間等屬性。區分為主要時鐘顯示（正中央）和次要時鐘顯示（城市列表）。

- **城市時區 (City Timezone)**: 代表一個城市的時區資訊，包含城市名稱、標準時區偏移量（如 GMT+8）、是否支援夏令時間、當前是否處於夏令時間等屬性。

- **時間狀態 (Time State)**: 代表當前應用程式的時間顯示狀態，包含主要顯示的城市、所有城市列表、當前時間戳等屬性。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者開啟頁面後，能夠在 2 秒內看到所有 10 個城市的時間顯示（1 個主要 + 9 個次要）
- **SC-002**: 時間更新延遲不超過 100 毫秒，確保使用者看到的時間是即時且準確的
- **SC-003**: 使用者能夠在 1 秒內完成主要時間的切換操作（從點選到畫面更新完成）
- **SC-004**: 所有時區的時間顯示準確度達到 100%，包括正確處理夏令時間轉換
- **SC-005**: 視覺回饋（hover 和點選效果）的響應時間不超過 50 毫秒，提供流暢的互動體驗。測量方法：使用 Chrome DevTools Performance 記錄，測量從 mouseenter 事件到背景色變更的時間
- **SC-006**: 頁面持續運行 24 小時後，時間顯示仍保持準確，無累積誤差或停止更新的情況
- **SC-007**: 90% 的使用者能在首次使用時直覺地理解如何切換主要時間顯示，無需額外說明
